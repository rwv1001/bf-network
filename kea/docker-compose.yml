services:
  kea:
    image: jonasal/kea-dhcp4:3.0-alpine   # even minor = stable/LTS
    container_name: kea
    restart: unless-stopped
    network_mode: host
    cap_add: [ NET_ADMIN ]
    command: ["-c", "/kea/config/dhcp4.json"]
    volumes:
      - ./config:/kea/config
      - ./leases:/kea/leases
      - ./sockets:/kea/sockets
    entrypoint: |
      sh -c '
      rm -f /usr/local/var/run/kea/dhcp4.kea-dhcp4.pid
      kea-dhcp4 -c /kea/config/dhcp4.json &
      KEA_PID=$!
      sleep 3
      chmod 666 /kea/sockets/kea4-ctrl-socket
      wait $KEA_PID
      '
