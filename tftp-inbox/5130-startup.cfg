#
 version 7.1.070, Release 3507P18
#
 sysname AccessSW-01
#
 clock timezone GMT add 00:00:00
 clock summer-time BST 01:00:00 March last Sunday 02:00:00 October last Sunday 01:00:00
#
 irf mac-address persistent timer
 irf auto-update enable
 undo irf link-delay
 irf member 1 priority 1
#
 mac-authentication 
 mac-authentication domain macauth 
#
 web-auth free-ip 192.168.99.4 255.255.255.255
#
 dhcp snooping enable
 dhcp snooping enable vlan 70 
#
 dns proxy enable
 dns source-interface Vlan-interface1
 dns server 1.1.1.1
 dns server 8.8.8.8
#
 lldp global enable
#
 password-recovery enable
#
vlan 1
 name UDM
 dhcp snooping binding record
#
vlan 10
 name friars
 dhcp snooping binding record
 arp detection enable
#
vlan 11
#
vlan 20
 name staff
 dhcp snooping binding record
#
vlan 30
 name students
 dhcp snooping binding record
#
vlan 40
 name guests
 dhcp snooping binding record
#
vlan 50
 name contractors
 dhcp snooping binding record
#
vlan 60
 name volunteers
 dhcp snooping binding record
#
vlan 70
 name IoT
 dhcp snooping binding record
#
vlan 90
 dhcp snooping binding record
#
vlan 99
 name REG
 dhcp snooping binding record
#
vlan 1028
 name NATIVE-NULL
#
 stp global enable
#
interface NULL0
#
interface Vlan-interface1
 description GW_VLAN1_FROM_5130
 ip address 192.168.1.3 255.255.255.0
#
interface Vlan-interface10
 description GW_VLAN10
 ip address 192.168.10.1 255.255.255.0
 packet-filter 3100 inbound
#
interface Vlan-interface20
 description GW_VLAN20
 ip address 192.168.20.1 255.255.255.0
 packet-filter 3200 outbound
#
interface Vlan-interface30
 description GW_VLAN30
 ip address 192.168.30.1 255.255.255.0
 packet-filter 3300 outbound
#
interface Vlan-interface40
 description GW_VLAN40
 ip address 192.168.40.1 255.255.255.0
 packet-filter 3400 outbound
#
interface Vlan-interface50
 description GW_VLAN50
 ip address 192.168.50.1 255.255.255.0
 packet-filter 3500 outbound
#
interface Vlan-interface60
 description GW_VLAN60
 ip address 192.168.60.1 255.255.255.0
 packet-filter 3600 outbound
#
interface Vlan-interface70
 description GW_VLAN70
 ip address 192.168.70.1 255.255.255.0
 packet-filter 3700 outbound
#
interface Vlan-interface90
 packet-filter 3900 outbound
#
interface Vlan-interface99
 description GW_VLAN99
 ip address 192.168.99.1 255.255.255.0
 packet-filter 3099 inbound
 packet-filter 3099 outbound
#
interface GigabitEthernet1/0/1
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/2
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/3
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/4
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/5
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/6
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/7
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/8
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/9
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/10
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/11
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/12
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/13
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/14
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/15
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/16
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/17
 description Uplink to UniFi AP
 port link-type hybrid
 port hybrid vlan 10 20 30 40 50 60 70 99 tagged
 port hybrid vlan 1 untagged
 mac-authentication max-user 256
 mac-authentication domain macauth
 mac-authentication host-mode multi-vlan
#
interface GigabitEthernet1/0/18
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/19
 port link-type hybrid
 undo port hybrid vlan 1
 port hybrid vlan 10 20 30 40 50 60 70 99 untagged
 port hybrid pvid vlan 99
 ip verify source ip-address mac-address
 mac-authentication
 mac-authentication host-mode multi-vlan
 web-auth domain macauth
 web-auth enable apply server PI-PORTAL
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/20
 ip verify source ip-address mac-address
 dhcp snooping check mac-address
#
interface GigabitEthernet1/0/21
 port access vlan 99
 mac-authentication
 mac-authentication max-user 4
 mac-authentication domain macauth
#
interface GigabitEthernet1/0/22
 description PC-to-SSH-Pi
 port access vlan 99
 arp detection trust
#
interface GigabitEthernet1/0/23
 description TRUNK-TO-PI-Kea
 port link-type trunk
 undo port trunk permit vlan 1
 port trunk permit vlan 10 20 30 40 50 60 70 99
 port trunk pvid vlan 1028
 arp detection trust
 dhcp snooping trust
#
interface GigabitEthernet1/0/24
 description TRUNK-TO-UDM (transit only)
 dhcp snooping trust
#
interface Ten-GigabitEthernet1/0/25
#
interface Ten-GigabitEthernet1/0/26
#
interface Ten-GigabitEthernet1/0/27
#
interface Ten-GigabitEthernet1/0/28
#
 scheduler logfile size 16
#
scheduler job backup-config
 command 1 save safely force
 command 2 tftp 192.168.99.4 put flash:/startup.cfg 5130-startup.cfg
#
scheduler schedule nightly-backup
 user-role network-admin
 job backup-config
 time repeating at 03:15
#
line class aux
 authentication-mode scheme
 user-role network-admin
#
line class vty
 user-role network-operator
#
line aux 0
 user-role network-admin
#
line vty 0 4
 authentication-mode scheme
 user-role network-operator
 protocol inbound ssh
 idle-timeout 15 0
#
line vty 5 63
 user-role network-operator
#
 ip route-static 0.0.0.0 0 192.168.1.1
#
 ssh server enable
#
 arp detection validate dst-mac ip src-mac
#
 ntp-service enable
 ntp-service source Vlan-interface1
 ntp-service unicast-server 192.168.99.4
 ntp-service unicast-server 162.159.200.1
#
acl number 3000 name PREAUTH
 rule 1 permit udp source-port eq bootpc destination-port eq bootps
 rule 2 permit udp source-port eq bootps destination-port eq bootpc
 rule 5 permit udp destination 192.168.99.4 0 destination-port eq dns
 rule 6 permit tcp destination 192.168.99.4 0 destination-port eq dns
 rule 10 permit tcp destination 192.168.99.4 0 destination-port eq www
 rule 11 permit tcp destination 192.168.99.4 0 destination-port eq 443
 rule 100 deny ip
#
acl number 3001
 rule 5 permit ip
#
acl number 3099 name VLAN99_EGRESS
 rule 0 permit ip source 192.168.99.0 0.0.0.255 destination 192.168.1.0 0.0.0.255
 rule 1 permit ip source 192.168.99.4 0
 rule 5 deny ip source 192.168.99.0 0.0.0.255
 rule 100 permit ip
#
acl advanced 3100 match-order auto
 description "VLAN10 Walled Garden and Captive Portal Only"
 rule 20 permit udp source 192.168.10.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 40 permit tcp source 192.168.10.128 0.0.0.127 destination 192.168.99.4 0 destination-port eq www
 rule 50 permit tcp source 192.168.10.128 0.0.0.127 destination 192.168.99.4 0 destination-port eq 443
 rule 55 permit tcp source 192.168.10.128 0.0.0.127 destination 192.168.99.4 0 destination-port eq 8080
 rule 70 permit icmp source 192.168.10.128 0.0.0.127 destination 192.168.99.4 0
 rule 30 permit udp source 192.168.10.128 0.0.0.127 destination-port eq dns
 rule 31 permit tcp source 192.168.10.128 0.0.0.127 destination-port eq dns
 rule 60 permit udp source 192.168.10.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.10.0 0.0.0.127
 rule 100 deny ip source 192.168.10.128 0.0.0.127
 rule 200 permit ip
#
acl advanced 3101 match-order auto
 description "VLAN10 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.10.5 0.0.0.122
#
acl advanced 3200 match-order auto
 description "VLAN20 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.20.128 0.0.0.127 destination 192.168.20.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.20.128 0.0.0.127 destination 192.168.20.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.20.128 0.0.0.127 destination 192.168.20.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.20.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.20.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.20.5 0.0.0.122
 rule 100 deny ip source 192.168.20.128 0.0.0.127
#
acl advanced 3201 match-order auto
 description "VLAN20 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.20.5 0.0.0.122
#
acl advanced 3300 match-order auto
 description "VLAN30 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.30.128 0.0.0.127 destination 192.168.30.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.30.128 0.0.0.127 destination 192.168.30.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.30.128 0.0.0.127 destination 192.168.30.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.30.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.30.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.30.5 0.0.0.122
 rule 100 deny ip source 192.168.30.128 0.0.0.127
#
acl advanced 3301 match-order auto
 description "VLAN30 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.30.5 0.0.0.122
#
acl advanced 3400 match-order auto
 description "VLAN40 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.40.128 0.0.0.127 destination 192.168.40.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.40.128 0.0.0.127 destination 192.168.40.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.40.128 0.0.0.127 destination 192.168.40.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.40.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.40.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.40.5 0.0.0.122
 rule 100 deny ip source 192.168.40.128 0.0.0.127
#
acl advanced 3401 match-order auto
 description "VLAN40 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.40.5 0.0.0.122
#
acl advanced 3500 match-order auto
 description "VLAN50 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.50.128 0.0.0.127 destination 192.168.50.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.50.128 0.0.0.127 destination 192.168.50.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.50.128 0.0.0.127 destination 192.168.50.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.50.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.50.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.50.5 0.0.0.122
 rule 100 deny ip source 192.168.50.128 0.0.0.127
#
acl advanced 3501 match-order auto
 description "VLAN50 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.50.5 0.0.0.122
#
acl advanced 3600 match-order auto
 description "VLAN60 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.60.128 0.0.0.127 destination 192.168.60.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.60.128 0.0.0.127 destination 192.168.60.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.60.128 0.0.0.127 destination 192.168.60.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.60.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.60.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.60.5 0.0.0.122
 rule 100 deny ip source 192.168.60.128 0.0.0.127
#
acl advanced 3601 match-order auto
 description "VLAN60 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.60.5 0.0.0.122
#
acl advanced 3700 match-order auto
 description "VLAN70 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.70.128 0.0.0.127 destination 192.168.70.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.70.128 0.0.0.127 destination 192.168.70.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.70.128 0.0.0.127 destination 192.168.70.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.70.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.70.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.70.5 0.0.0.122
 rule 100 deny ip source 192.168.70.128 0.0.0.127
#
acl advanced 3701 match-order auto
 description "VLAN70 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.70.5 0.0.0.122
#
acl advanced 3900 match-order auto
 description "VLAN90 Walled Garden and Full Access"
 rule 20 permit udp source 192.168.90.128 0.0.0.127 destination 192.168.90.4 0 destination-port eq dns
 rule 30 permit tcp source 192.168.90.128 0.0.0.127 destination 192.168.90.4 0 destination-port eq www
 rule 40 permit tcp source 192.168.90.128 0.0.0.127 destination 192.168.90.4 0 destination-port eq 443
 rule 50 permit udp source 192.168.90.128 0.0.0.127 destination 255.255.255.255 0 destination-port eq bootps
 rule 60 permit udp source 192.168.90.128 0.0.0.127 destination-port eq ntp
 rule 10 permit ip source 192.168.90.5 0.0.0.122
 rule 100 deny ip source 192.168.90.128 0.0.0.127
#
acl advanced 3901 match-order auto
 description "VLAN90 Full Access - Registered Devices"
 rule 10 permit ip source 192.168.90.5 0.0.0.122
#
user-profile PREAUTH
#
 password-control enable 
 undo password-control aging enable 
 undo password-control length enable 
 undo password-control composition enable 
 undo password-control history enable 
 password-control login-attempt 3 exceed unlock 
 password-control update-interval 0
 password-control login idle-time 0
#
radius scheme rad1
 primary authentication 192.168.99.4 key cipher $c$3$IoZX4ESNsAZmEHLTFxP666LqyzyBPzbIwOFQkuw=
 primary accounting 192.168.99.4 key cipher $c$3$plJO+FpFuvKWsQWz4rb2Xc6pz783lclOLdbSnQY=
 key authentication cipher $c$3$k6KFt6ALTXSbQK58tLrbE6i8vMZD3FSHMEQt6Xzf
 key accounting cipher $c$3$dhgKIwvOehwhiXTovQvIKx5MM4CUqTvnJa+HdNQW
 user-name-format without-domain
 nas-ip 192.168.99.1
#
radius scheme system
 user-name-format without-domain
#
radius dynamic-author server
 client ip 192.168.99.4 key cipher $c$3$VShSG4+DKpXKeZGH/L6lYsVzdyy99LCBIUN5CvGw7ha6hiY=
#
domain macauth
 authentication lan-access radius-scheme rad1
 authorization lan-access radius-scheme rad1
 accounting lan-access radius-scheme rad1
 authentication portal radius-scheme rad1
 authorization portal radius-scheme rad1
 accounting portal radius-scheme rad1
#
domain system
#
 domain default enable system
#
role name level-0
 description Predefined level-0 role
#
role name level-1
 description Predefined level-1 role
#
role name level-2
 description Predefined level-2 role
#
role name level-3
 description Predefined level-3 role
#
role name level-4
 description Predefined level-4 role
#
role name level-5
 description Predefined level-5 role
#
role name level-6
 description Predefined level-6 role
#
role name level-7
 description Predefined level-7 role
#
role name level-8
 description Predefined level-8 role
#
role name level-9
 description Predefined level-9 role
#
role name level-10
 description Predefined level-10 role
#
role name level-11
 description Predefined level-11 role
#
role name level-12
 description Predefined level-12 role
#
role name level-13
 description Predefined level-13 role
#
role name level-14
 description Predefined level-14 role
#
user-group system
#
local-user admin class manage
 service-type ssh terminal
 authorization-attribute user-role network-admin
#
 security-enhanced level 1
#
 portal free-rule 30 destination ip 192.168.99.4 255.255.255.255 tcp 443
#
portal web-server piportal
 url https://https://bf-network.duckdns.org/register/
#
web-auth server PI-PORTAL
 url http://192.168.99.4:8080/register/
 ip 192.168.99.4 port 8080
#
return
